<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2D Ball Collision Simulation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f0f0;
    }

    canvas {
      background: #087423;
      display: block;
      margin: 20px auto;
      border: 2px solid black;
    }

    #controls {
      text-align: center;
      margin-top: 15px;
    }

    label, button, input {
      margin: 5px;
      font-size: 16px;
      padding: 8px;
    }

    input {
      width: 60px;
    }

    #info, #velocityInfo, #collisionInfo {
      margin: 20px auto;
      max-width: 800px;
      padding: 15px;
      border-radius: 10px;
    }

    #info {
      background-color: #e0f7fa;
      border: 2px solid #0288d1;
    }

    #velocityInfo {
      background-color: #f1f8e9;
      border: 2px solid #689f38;
      text-align: center;
    }

    #collisionInfo {
      background-color: #fff3e0;
      border: 2px solid #f57c00;
      font-weight: bold;
      display: none;
      text-align: center;
    }

    h2 {
      text-align: center;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div id="controls">
    <label>Red Ball X: <input type="number" id="redX" value="200" /></label>
    <label>Red Ball Y: <input type="number" id="redY" value="200" /></label>
    <label>Red vx: <input type="number" id="redVx" value="5" step="0.5" /></label>
    <label>Red vy: <input type="number" id="redVy" value="0" step="0.5" /></label>
    <br>
    <button id="startBtn">Start</button>
    <button id="resetBtn">Reset</button>
    <button id="frictionBtn">Friction: Off</button>
  </div>

  <section id="info">
    <h2>ðŸ§ª Simulation Instructions</h2>
    <p>ðŸ”´ Red Ball: Initial velocity set by user</p>
    <p>ðŸ”µ Blue Ball: Initial velocity is 0</p>
    <p>Click "Start" to begin the simulation.</p>
    <p>Click "Reset" to reset the simulation.</p>
    <p>Click "Friction" to toggle friction on/off.</p>
  </section>

  <canvas id="simCanvas" width="800" height="400"></canvas>

  <section id="velocityInfo">
    <h2>ðŸ“ˆ Ball Velocities</h2>
    <p>ðŸ”´ Red Ball Velocity: <span id="redVel">0.00</span></p>
    <p>ðŸ”µ Blue Ball Velocity: <span id="blueVel">0.00</span></p>
  </section>

  <section id="collisionInfo"></section>

  <script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;

    let animation;
    let frictionEnabled = false;
    const friction = 0.99;

    const defaultLeft = { vx: 5, vy: 0, r: 20, color: 'red' };
    const rightBallInitial = { x: 600, y: 200, vx: 0, vy: 0, r: 20, color: 'blue' };

    let leftBall = {};
    let rightBall = { ...rightBallInitial };

    const redVelText = document.getElementById('redVel');
    const blueVelText = document.getElementById('blueVel');
    const collisionBox = document.getElementById('collisionInfo');

    function getUserInputValues() {
      const x = parseFloat(document.getElementById('redX').value);
      const y = parseFloat(document.getElementById('redY').value);
      const vx = parseFloat(document.getElementById('redVx').value);
      const vy = parseFloat(document.getElementById('redVy').value);
      return { x, y, vx, vy };
    }

    function resetBalls() {
      const { x, y, vx, vy } = getUserInputValues();
      leftBall = { x, y, vx, vy, r: 20, color: 'red' };
      rightBall = { ...rightBallInitial };
      collisionBox.style.display = 'none';
      drawScene(true);
    }

    function drawBall(ball) {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.r, 0, 2 * Math.PI);
      ctx.fillStyle = ball.color;
      ctx.fill();
      ctx.lineWidth = 3;
      ctx.strokeStyle = 'white';
      ctx.stroke();
      ctx.closePath();

      // Velocity arrow
      ctx.beginPath();
      ctx.moveTo(ball.x, ball.y);
      ctx.lineTo(ball.x + ball.vx * 5, ball.y + ball.vy * 5);
      ctx.strokeStyle = 'yellow';
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.closePath();
    }

    function drawScene(fullClear = false) {
      if (fullClear) {
        ctx.clearRect(0, 0, width, height);
      } else {
        ctx.fillStyle = 'rgba(8, 116, 35, 0.3)';
        ctx.fillRect(0, 0, width, height);
      }

      drawBall(leftBall);
      drawBall(rightBall);

      updateVelocityDisplay();
    }

    function updateVelocityDisplay() {
      const speedLeft = Math.sqrt(leftBall.vx ** 2 + leftBall.vy ** 2).toFixed(2);
      const speedRight = Math.sqrt(rightBall.vx ** 2 + rightBall.vy ** 2).toFixed(2);
      redVelText.textContent = speedLeft;
      blueVelText.textContent = speedRight;
    }

    function distance(ball1, ball2) {
      const dx = ball2.x - ball1.x;
      const dy = ball2.y - ball1.y;
      return Math.sqrt(dx * dx + dy * dy);
    }

    function resolveCollision(ball1, ball2) {
      const dx = ball2.x - ball1.x;
      const dy = ball2.y - ball1.y;
      const angle = Math.atan2(dy, dx);

      const speed1 = Math.sqrt(ball1.vx ** 2 + ball1.vy ** 2);
      const speed2 = Math.sqrt(ball2.vx ** 2 + ball2.vy ** 2);

      const direction1 = Math.atan2(ball1.vy, ball1.vx);
      const direction2 = Math.atan2(ball2.vy, ball2.vx);

      const vx1 = speed1 * Math.cos(direction1 - angle);
      const vy1 = speed1 * Math.sin(direction1 - angle);
      const vx2 = speed2 * Math.cos(direction2 - angle);
      const vy2 = speed2 * Math.sin(direction2 - angle);

      const finalVx1 = vx2;
      const finalVx2 = vx1;

      ball1.vx = Math.cos(angle) * finalVx1 + Math.cos(angle + Math.PI / 2) * vy1;
      ball1.vy = Math.sin(angle) * finalVx1 + Math.sin(angle + Math.PI / 2) * vy1;
      ball2.vx = Math.cos(angle) * finalVx2 + Math.cos(angle + Math.PI / 2) * vy2;
      ball2.vy = Math.sin(angle) * finalVx2 + Math.sin(angle + Math.PI / 2) * vy2;

      showCollisionInfo(speed1.toFixed(2), speed2.toFixed(2));
    }

    function showCollisionInfo(speed1, speed2) {
      collisionBox.innerHTML = `
        ðŸ’¥ <strong>Collision Detected!</strong><br>
        ðŸ”´ Red Ball Speed: ${speed1}<br>
        ðŸ”µ Blue Ball Speed: ${speed2}
      `;
      collisionBox.style.display = 'block';
    }

    function update() {
      const dist = distance(leftBall, rightBall);
      if (dist <= leftBall.r + rightBall.r) {
        resolveCollision(leftBall, rightBall);
      }

      if (frictionEnabled) {
        leftBall.vx *= friction;
        leftBall.vy *= friction;
        rightBall.vx *= friction;
        rightBall.vy *= friction;
      }

      leftBall.x += leftBall.vx;
      leftBall.y += leftBall.vy;
      rightBall.x += rightBall.vx;
      rightBall.y += rightBall.vy;

      [leftBall, rightBall].forEach(ball => {
        if (ball.x - ball.r < 0 || ball.x + ball.r > width) ball.vx *= -1;
        if (ball.y - ball.r < 0 || ball.y + ball.r > height) ball.vy *= -1;
      });

      drawScene();
      animation = requestAnimationFrame(update);
    }

    document.getElementById('startBtn').addEventListener('click', () => {
      cancelAnimationFrame(animation);
      resetBalls();
      animation = requestAnimationFrame(update);
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      cancelAnimationFrame(animation);
      resetBalls();
    });

    document.getElementById('frictionBtn').addEventListener('click', () => {
      frictionEnabled = !frictionEnabled;
      document.getElementById('frictionBtn').textContent = `Friction: ${frictionEnabled ? 'On' : 'Off'}`;
    });

    resetBalls(); // Initial draw
  </script>
</body>
</html>
